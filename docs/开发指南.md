# 失效分析智能辅助平台 - 开发指南

## 项目概述

失效分析智能辅助平台（SmartFA）是一个基于AI的综合性失效分析平台，采用微服务架构，包含多模态工作台、智能中枢和多智能体集群三大核心模块。

## 技术架构

### 前端技术栈
- **框架**: React 18 + TypeScript
- **UI组件**: Ant Design 5.x
- **状态管理**: Redux Toolkit
- **构建工具**: Vite
- **图表**: ECharts + D3.js
- **3D渲染**: Three.js

### 后端技术栈
- **框架**: Spring Boot 3.x (Java 17)
- **数据库**: PostgreSQL + MongoDB + Redis + InfluxDB
- **消息队列**: Apache Kafka
- **对象存储**: MinIO
- **向量数据库**: Milvus
- **AI框架**: Python 3.11 + PyTorch + Transformers

### 基础设施
- **容器化**: Docker + Docker Compose
- **编排**: Kubernetes (可选)
- **监控**: Prometheus + Grafana
- **日志**: ELK Stack

## 快速开始

### 环境要求
- Docker 20.10+
- Docker Compose 2.0+
- Node.js 16+ (本地开发)
- Java 17+ (本地开发)
- Maven 3.8+ (本地开发)

### 一键部署
```bash
# 克隆项目
git clone <repository-url>
cd smartFA

# 完整部署
./scripts/deploy.sh deploy
```

### 本地开发

#### 前端开发
```bash
cd frontend
npm install
npm run dev
```

#### 后端开发
```bash
cd backend
mvn clean install
# 启动各个服务
cd multimodal-workbench && mvn spring-boot:run
cd intelligent-hub && mvn spring-boot:run
cd multi-agent-cluster && mvn spring-boot:run
```

## 项目结构

```
smartFA/
├── frontend/                 # 前端应用
│   ├── src/
│   │   ├── components/       # 通用组件
│   │   ├── pages/           # 页面组件
│   │   ├── store/           # Redux状态管理
│   │   ├── services/        # API服务
│   │   ├── utils/           # 工具函数
│   │   └── types/           # TypeScript类型定义
│   ├── package.json
│   └── vite.config.ts
├── backend/                  # 后端服务
│   ├── multimodal-workbench/ # 多模态工作台
│   ├── intelligent-hub/     # 智能中枢
│   ├── multi-agent-cluster/ # 多智能体集群
│   └── common/              # 公共模块
├── ai-services/              # AI服务
│   ├── image-analysis/      # 图像分析
│   ├── document-analysis/   # 文档分析
│   ├── llm-service/         # 大语言模型
│   └── agent-framework/     # 智能体框架
├── infrastructure/           # 基础设施
│   ├── docker/              # Docker配置
│   ├── kubernetes/          # K8s配置
│   ├── nginx/               # Nginx配置
│   └── monitoring/          # 监控配置
├── scripts/                 # 部署脚本
├── docs/                    # 文档
└── docker-compose.yml       # 容器编排
```

## 核心模块

### 1. 多模态工作台 (Multimodal Workbench)

**功能职责**:
- 图像采集与预处理
- 文档解析与内容提取
- 多模态数据融合
- 任务触发与分发

**技术实现**:
- Spring Boot 3.x
- OpenCV + PIL (图像处理)
- Apache Tika (文档解析)
- Kafka Producer (消息发送)

**API接口**:
```java
@RestController
@RequestMapping("/api/workbench")
public class MultimodalWorkbenchController {
    
    @PostMapping("/upload")
    public Result<FileUploadVO> uploadFile(@RequestParam("file") MultipartFile file);
    
    @PostMapping("/tasks/create")
    public Result<TaskVO> createAnalysisTask(@RequestBody CreateTaskDTO dto);
    
    @GetMapping("/tasks/{taskId}")
    public Result<TaskDetailVO> getTaskDetail(@PathVariable String taskId);
}
```

### 2. 智能中枢 (Intelligent Hub)

**功能职责**:
- 任务智能分解
- 资源动态调度
- 工作流编排
- 结果聚合

**技术实现**:
- Spring Boot 3.x
- Python AI服务集成
- Redis Streams (任务队列)
- Quartz Scheduler (定时任务)

**核心算法**:
```python
class TaskDecomposer:
    def decompose_task(self, task: Task) -> List[SubTask]:
        # 基于规则和ML的任务分解算法
        pass
    
class ResourceScheduler:
    def schedule_resources(self, tasks: List[Task]) -> Schedule:
        # 资源调度算法
        pass
```

### 3. 多智能体集群 (Multi-Agent Cluster)

**功能职责**:
- 智能体生命周期管理
- 任务分配与执行
- 智能体间通信
- 结果收集与反馈

**技术实现**:
- FastAPI + Python
- Ray Framework (分布式计算)
- gRPC (智能体通信)
- Milvus (向量检索)

**智能体类型**:
- 视觉分析智能体
- 光谱分析智能体
- 数据处理智能体
- 语言理解智能体
- 多模态融合智能体

## 开发规范

### 代码规范

#### Java代码规范
- 遵循阿里巴巴Java开发手册
- 使用Lombok简化代码
- 统一异常处理
- API接口使用Swagger文档

#### Python代码规范
- 遵循PEP 8规范
- 使用Black格式化代码
- 类型注解
- 文档字符串

#### TypeScript代码规范
- 使用ESLint + Prettier
- 严格的TypeScript配置
- 组件化开发
- 统一的命名规范

### Git规范

#### 分支策略
- `main`: 主分支，用于生产环境
- `develop`: 开发分支，用于集成测试
- `feature/*`: 功能分支
- `hotfix/*`: 热修复分支

#### 提交规范
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 代码重构
test: 测试相关
chore: 构建过程或辅助工具的变动
```

### API设计规范

#### RESTful API
- 使用名词复数形式
- HTTP状态码规范
- 统一的响应格式
- 版本控制策略

#### 响应格式
```json
{
  "code": 200,
  "message": "操作成功",
  "data": {},
  "timestamp": 1642234567890,
  "requestId": "uuid"
}
```

## 测试策略

### 单元测试
- Java: JUnit 5 + Mockito
- Python: pytest + unittest.mock
- TypeScript: Jest + React Testing Library

### 集成测试
- 使用Testcontainers
- API接口测试
- 数据库集成测试

### 端到端测试
- Cypress (前端)
- Postman/Newman (API)

## 部署指南

### 开发环境
```bash
./scripts/deploy.sh deploy
```

### 生产环境
```bash
# 使用Kubernetes部署
kubectl apply -f infrastructure/kubernetes/
```

### 环境变量配置
```bash
# 数据库配置
SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/smartfa
SPRING_DATASOURCE_USERNAME=smartfa
SPRING_DATASOURCE_PASSWORD=smartfa123

# Redis配置
SPRING_REDIS_HOST=localhost
SPRING_REDIS_PORT=6379
SPRING_REDIS_PASSWORD=smartfa123

# Kafka配置
KAFKA_BOOTSTRAP_SERVERS=localhost:9092

# MinIO配置
MINIO_ENDPOINT=http://localhost:9000
MINIO_ACCESS_KEY=smartfa
MINIO_SECRET_KEY=smartfa123
```

## 监控与运维

### 应用监控
- Spring Boot Actuator
- Micrometer + Prometheus
- Grafana仪表板

### 日志管理
- Logback + ELK Stack
- 结构化日志
- 链路追踪

### 性能优化
- 数据库索引优化
- Redis缓存策略
- JVM调优
- 前端性能优化

## 安全考虑

### 认证授权
- JWT Token认证
- RBAC权限控制
- API接口鉴权

### 数据安全
- 数据传输加密
- 敏感数据脱敏
- 数据备份策略

### 网络安全
- HTTPS/TLS
- 防火墙配置
- DDoS防护

## 故障排查

### 常见问题

#### 服务启动失败
1. 检查端口占用
2. 检查环境变量
3. 查看服务日志

#### 数据库连接失败
1. 检查数据库服务状态
2. 验证连接配置
3. 检查网络连通性

#### AI服务异常
1. 检查模型文件
2. 验证GPU资源
3. 查看推理日志

### 日志查看
```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f multimodal-workbench

# 查看最近的错误日志
docker-compose logs --tail=100 | grep ERROR
```

## 扩展开发

### 添加新的智能体类型
1. 在`ai-services/agent-framework/`中创建新的智能体类
2. 实现基础的Agent接口
3. 注册到智能体管理器
4. 更新前端界面

### 集成新的AI模型
1. 在`ai-services/`下创建对应的服务模块
2. 实现模型加载和推理接口
3. 添加配置文件
4. 更新API文档

### 添加新的数据源
1. 扩展数据采集模块
2. 实现数据解析器
3. 更新数据模型
4. 添加相应的测试

## 贡献指南

1. Fork项目
2. 创建功能分支
3. 提交代码
4. 创建Pull Request
5. 代码审查
6. 合并代码

## 联系方式

- 项目维护者: SmartFA Team
- 邮箱: smartfa@example.com
- 文档地址: [项目Wiki]
- 问题反馈: [GitHub Issues]

---

*本文档持续更新中，如有问题请及时反馈。*